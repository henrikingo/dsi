task_name: tpcc
run:

  - id: tpcc_test
    type: tpcc
    cmd: |
      cd tpcc/pytpcc
      rm -f results.log
      python ./tpcc.py --print-config mongodb > mongodb.config
      sed -i "s/localhost/${mongodb_setup.meta.hostname}/g" mongodb.config
      sed -i "s/27017/${mongodb_setup.meta.port}/g" mongodb.config
      sed -i "s/replset/rs0/g" mongodb.config
      python ./tpcc.py --reset --clients=10 --warehouses=4 --duration=360 --config=mongodb.config mongodb
    output_files:
      - tpcc/pytpcc/results.log

  - id: fio
    type: fio
    cmd: '${infrastructure_provisioning.numactl_prefix} ./fio-test.sh ${mongodb_setup.meta.hostname}'
    config_filename: fio.ini
    output_files:
      - fio.json
      - fio_results.tgz
    workload_config: ${test_control.common_fio_config}
    skip_validate: true

  - id: iperf
    type: iperf
    cmd: '${infrastructure_provisioning.numactl_prefix} ./iperf-test.sh ${mongodb_setup.meta.hostname}'
    output_files:
      - iperf.json
    skip_validate: true
