task_name: ycsb.short
run:
  - id: ycsb_load
    type: ycsb
    "cmd": "cd YCSB/ycsb-mongodb; ${infrastructure_provisioning.numactl_prefix} ./bin/ycsb load mongodb -s -P workloads/workloadShort -p mongodb.url=mongodb://${mongodb_setup.meta.hosts}/ycsb -threads 32; sleep 1"
    config_filename: workloadShort
    workload_config: |
      recordcount=2500000
      operationcount=3000000
      workload=com.yahoo.ycsb.workloads.CoreWorkload
      readallfields=true
      readproportion=0.5
      updateproportion=0.5
      scanproportion=0
      insertproportion=0.0
      requestdistribution=zipfian
    pre_test:
      - on_workload_client:
          upload_files:
            workloadShort: YCSB/ycsb-mongodb/workloads/workloadShort
  - id: ycsb_50read50update
    type: ycsb
    "cmd": "cd YCSB/ycsb-mongodb; ${infrastructure_provisioning.numactl_prefix} ./bin/ycsb run mongodb -s -P workloads/workloadShort -p mongodb.url=mongodb://${mongodb_setup.meta.hosts}/ycsb -threads 64; sleep 1"

pre_task:
  - on_localhost:
      exec: $DSI_PATH/bin/setup-ycsb.sh
  - on_workload_client:
      exec: rm -rf ycsb*
  - on_workload_client:
      upload_files:
        ycsb.tar.gz: ycsb.tar.gz
  - on_workload_client:
      exec: |
        rm -rf YCSB
        mkdir YCSB
        tar zxvf ycsb.tar.gz -C YCSB
        export JAVA_HOME="/usr/java/jdk1.7.0_71/jre"
        source /etc/profile.d/maven.sh && cd /home/ec2-user/YCSB/ycsb-mongodb && mvn clean package