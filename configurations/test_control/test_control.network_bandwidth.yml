task_name: network_bandwidth
run:
  - id: iperf
    type: iperf
    cmd: 'for i in `seq 1 5`; do  sudo rm -f iperf.json; sudo /usr/local/bin/iperf3 -c 10.2.0.200 -i 2 -t 60 -V -p 27019 -J --logfile iperf.json &&  python ./process_iperf_results.py && mv iperf.json iperf.$i.json; done;'

pre_task:
  - on_mongod:  # This could be in pre-run
      exec: |
        sudo /usr/local/bin/iperf3 -s -p 27019 -D
post_task:
  - on_workload_client:
      retrieve_files:
        - source: iperf.1.json
          target: ../iperf.1.json
        - source: iperf.2.json
          target: ../iperf.2.json
        - source: iperf.3.json
          target: ../iperf.3.json
        - source: iperf.4.json
          target: ../iperf.4.json
        - source: iperf.5.json
          target: ../iperf.5.json
