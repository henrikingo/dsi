# This essentially ports dsi/clusters/*/*.json to yml. Additions are up for debate.
# Note, unlike other files, this is a list of test runs. Hence, even if there's only a single entry, it is a list.
run:
  - id: benchRun-mmapv1            # Note: standardize on engine explicitly being part of id, and using correct engine names, not "mmap"
    type: shell                    # or "ycsb"

    cmd: $DSI_PATH/workloads/run_workloads.py -c workloads.yml
    config_filename: workloads.yml # The name used in previous row
    workload_config:               # This section will be copied out into a file and given as config file
                                   # to the benchmark tool. Can be yml (run_workloads.py) or a text block (ycsb)
        ########################################################################
        # Test lists. Command line will indicate which list of tests to execute.
        # The 'default' list is the default.
        # When testing new test workloads, please put your tests in the
        # tests.test list, and remove the existing hello.js
        ########################################################################
        tests:
            default:
              - contended_update.js
              - map_reduce.js
              - ...
            initialsync:
              - initialsync.js
            correctness:
              - election_timing.js
              - election_timing_workload.js
            test: # Put new workloads here when testing
              - hello.js

        mongo:
            # Note: We shall move to use a connection string for all tests. This allows things like
            # multiple mongoses to be supported automatically
            # (After consideration, don't want automatic failover for perf tests. If it fails, fail hard.)
            uri: mongodb://${mongodb_setup.meta.hosts}/testdb?readPreference=PRIMARY
            sharded: ${mongodb_setup.meta.is_sharded}
            replica: ${mongodb_setup.meta.is_replset}
            storageEngine: ${mongodb_setup.mongod_config_file.storage.engine}

# Ordered list of things to do before the set of runs start
pre_task:
  - on_workload_client: |
    # to be executed on workload client (when MongoDB cluster is running)
  - on_workload_client_shell: |
    # JavaScript to be executed (once) in a mongo shell (when MongoDB cluster is running)
  - on_mongos: |
    # To be executed on all the mongos
  - on_mongod: |
    # To be executed on all the mongod
  - on_configsvr: |
    # To be executied on all the config servers

# Ordered list of things to do after all the runs
post_task:
  - on_workload_client: |
    # See above

# Ordered list of things to do before each run, after pre_task
pre_run:
  - on_mongos: (see above)
  - on_mongod: (see above)
  - on_configsvr: (see above)

# Ordered list of things to do after each run, before post_task
post_run:
  - on_mongod: (see above)
  - on_all_hosts: (see above)

    # Note: This config doesn't include things like PemFile, or ip addresses,
    # rather test control module will find that info in the infrastructure_provisioning config
