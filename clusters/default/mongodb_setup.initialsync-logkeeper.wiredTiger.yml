# Shared by all mongods
mongod_config_file:
    storage:
        engine: wiredTiger
    replication:
        oplogSizeMB: 2000000
        replSetName: logkeeper-rs0
    setParameter:
        numInitialSyncAttempts: 1

topology:
  - cluster_type: standalone
    # This is the primary mongod. Because it uses existing DB files from a snapshot, in which
    # replset is already configured. We do not want to run rs.init() for this instance, thus this
    # is standalone because it will skip replset initilization.
    # The global configuration "replSetName: logkeeper-rs0" will ensure this instance start with
    # proper mongod configuration file options.
    public_ip: ${infrastructure_provisioning.out.mongod_seeded_ebs.0.public_ip}
    private_ip: ${infrastructure_provisioning.out.mongod_seeded_ebs.0.private_ip}
    clean_db_dir: false
    use_journal_mnt: false
  - cluster_type: standalone
    # Secondary mongod instance, which is started from fresh DB files, and with proper replSetName
    # configured file options.
    public_ip: ${infrastructure_provisioning.out.mongod_ebs.0.public_ip}
    private_ip: ${infrastructure_provisioning.out.mongod_ebs.0.private_ip}
    use_journal_mnt: false

# Meta data about this mongodb setup
meta:
    # The list of hosts that can be used in a mongodb connection string
    hosts: ${mongodb_setup.topology.0.private_ip}:27017
    hostname: ${mongodb_setup.topology.0.private_ip}
    port: 27017
    secondary: ${mongodb_setup.topology.1.private_ip}
    is_sharded: false
    is_replset: true
