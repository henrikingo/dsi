command_type: system

pre:
  - command: shell.track

post:
  - command: shell.cleanup

functions:
  run_tests:
    - command: git.get_project
      params:
        directory: src
    - command: git.apply_patch
      params:
        directory: src
    - command: shell.exec
      type : test
      params:
        working_dir: src
        script: |
          virtualenv ./venv
          source ./venv/bin/activate
          pip install -r requirements.txt
          bash testscripts/runtests.sh

#######################################
#               Tasks                 #
#######################################
tasks:
- name: tests
  commands:
    - func: run_tests


#######################################
#            Buildvariants            #
#######################################

buildvariants:
- name: linux-runner
  display_name: Linux
  run_on:
      - "rhel70-perf-standalone"
  tasks:
    - name: tests
